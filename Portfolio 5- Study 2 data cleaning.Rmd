---
title: "Portfolio 5- Study 2 data cleaning"
author: "Adam"
date: "5/3/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

The goal of this markdown is to clean the data from Study 2 of my thesis.

## Set-up


```{r packages, echo=TRUE, message=FALSE}
library('reshape2')
library('dplyr')
library('Rcpp')
library('readr')
library('tidyverse')
library('psych')
```

### Pulling in the data

For this study, we have two datasets that we want to be able to combine into a single dataset. The first, Study 1 survey, has data from the survey we had participants take; and the second, Study 1 quiz, has their responses to the quiz they took.

First, we need to pull in the survey data

```{r bringing in survey data, echo=TRUE, collapse=TRUE, message=FALSE}
survey <- read_csv("data/Study 2 survey.csv")

# Ensuring the dataframe is a tibble.
as_tibble(survey)

#Taking a look at the table.
View(survey)
```

```{r bringing in survey data, echo=TRUE, collapse=TRUE, message=FALSE}
quiz <- read_csv("data/Study 2 Quiz.csv")

# Ensuring the dataframe is a tibble.
as_tibble(quiz)

#Taking a look at the table.
View(quiz)
```


Some cleaning was done in excel prior. 


As with Study 1, the data has already had its identifiers removed, but if it didn't, here is where that would be done. 

survey <- subset(survey, select= -c(StartDate, EndDate, Status,	IPAddress, Progress,
                Finished, RecordedDate, ResponseId, Durationinseconds, RecipientLastName, RecipientFirstName,
                RecipientEmail, ExternalReference, LocationLatitude, LocationLongitude,
                DistributionChannel, UserLanguage))
                
The same was done to quiz before merging.

The other bit of cleaning I did was ensuring that participants input their participant id, which is used to identify them across the two datasets, in the same way. In actual practice, I have an excel document that tracks all the manual changes that were made in cleaning that up, but it is not linked here.

The next step will be to create the merged data file.

```{r data merging, echo=TRUE, collapse=TRUE, message=FALSE}
study1 <- survey %>% 
  full_join(quiz, by = "participant_id")

#Always make sure it's a tibble
as_tibble(study1)

View(study1)
```

### Descriptives cleaning

Fortunately, this is a great opportunity to ensure that the code from Portfolio 1 is working, since much of the cleaning is pretty similar. 

##### Gender dummy coding

First, I need to look at whether we have non-binary individuals in the dataset.

I did not change the variable names to the more convenient ones used in Study 1, so I am going to do that now.

```{r renaming gender variables, collapse=TRUE}
#male
study1 <- rename(study1, "demog_gender_male" = demog_gender_2)

#female
study1 <- rename(study1, "demog_gender_female" = demog_gender_1)

#trans
study1 <- rename(study1, "demog_gender_trans" = demog_gender_31)

#twospirit
study1 <- rename(study1, "demog_gender_twospirit" = demog_gender_32)

#genderqueer
study1 <- rename(study1, "demog_gender_genderqueer" = demog_gender_33)

#other
study1 <- rename(study1, "demog_gender_other" = demog_gender_34)

#no answer
study1 <- rename(study1, "demog_gender_no_answer" = demog_gender_4)
```

```{r checking gender demographics}
study1 %>%
        filter(is.na(demog_gender_female), is.na(demog_gender_male)) %>%
        count(demog_gender_trans, demog_gender_twospirit, demog_gender_genderqueer, demog_gender_other, demog_gender_no_answer)

study1 %>%
count(demog_gender_trans, demog_gender_twospirit, demog_gender_genderqueer, demog_gender_other, demog_gender_no_answer)

```

A single participant answered that they were genderqueer. This is too little to do anything with, so I will only dichotomize gender.

```{r Creating  binary gender dummy code}
study1 <- study1 %>%
        mutate(
        gender_male_dummy=case_when(
                demog_gender_male == 1 ~ 1,
                demog_gender_female == 1 ~ 0
                ))
```


##### Race dummy coding

The first time the code should be able to be pulled directly!

To create the race dummy codes, I first need to create a multiracial composite so that I can avoid adding multiracial people to individual dummy codes. 

Because the individual race codes have NA in all unfilled spots, I need to replace them with 0's to get the code to work correctly. The code is a little hideous and not consolidated, but I prefer to look and see them individually, especially because I can collapse this code in the chunk.

```{r adding 0 to original code}

study1 <- study1 %>%
        mutate(demog_race_51=case_when(
                demog_race_51 == 1 ~ 1,
                is.na(demog_race_51) ~ 0
                                       ))

study1 <- study1 %>%
        mutate(demog_race_52=case_when(
                demog_race_52 == 1 ~ 1,
                is.na(demog_race_52) ~ 0
                                       ))

study1 <- study1 %>%
        mutate(demog_race_59=case_when(
                demog_race_59 == 1 ~ 1,
                is.na(demog_race_59) ~ 0
                                       ))
study1 <- study1 %>%
        mutate(demog_race_21=case_when(
                demog_race_21 == 1 ~ 1,
                is.na(demog_race_21) ~ 0
                                       ))

study1 <- study1 %>%
        mutate(demog_race_22=case_when(
                demog_race_22 == 1 ~ 1,
                is.na(demog_race_22) ~ 0
                                       ))

study1 <- study1 %>%
        mutate(demog_race_23=case_when(
                demog_race_23 == 1 ~ 1,
                is.na(demog_race_23) ~ 0
                                       ))

study1 <- study1 %>%
        mutate(demog_race_29=case_when(
                demog_race_29 == 1 ~ 1,
                is.na(demog_race_29) ~ 0
                                       ))

study1 <- study1 %>%
        mutate(demog_race_31=case_when(
                demog_race_31 == 1 ~ 1,
                is.na(demog_race_31) ~ 0
                                       ))

study1 <- study1 %>%
        mutate(demog_race_32=case_when(
                demog_race_32 == 1 ~ 1,
                is.na(demog_race_32) ~ 0
                                       ))

study1 <- study1 %>%
        mutate(demog_race_33=case_when(
                demog_race_33 == 1 ~ 1,
                is.na(demog_race_33) ~ 0
                                       ))

study1 <- study1 %>%
        mutate(demog_race_39=case_when(
                demog_race_39 == 1 ~ 1,
                is.na(demog_race_39) ~ 0
                                       ))

study1 <- study1 %>%
        mutate(demog_race_11=case_when(
                demog_race_11 == 1 ~ 1,
                is.na(demog_race_11) ~ 0
                                       ))

study1 <- study1 %>%
        mutate(demog_race_12=case_when(
                demog_race_12 == 1 ~ 1,
                is.na(demog_race_12) ~ 0
                                       ))

study1 <- study1 %>%
        mutate(demog_race_13=case_when(
                demog_race_13 == 1 ~ 1,
                is.na(demog_race_13) ~ 0
                                       ))

study1 <- study1 %>%
        mutate(demog_race_19=case_when(
                demog_race_19 == 1 ~ 1,
                is.na(demog_race_19) ~ 0
                                       ))

study1 <- study1 %>%
        mutate(demog_race_41=case_when(
                demog_race_41 == 1 ~ 1,
                is.na(demog_race_41) ~ 0
                                       ))

study1 <- study1 %>%
        mutate(demog_race_42=case_when(
                demog_race_42 == 1 ~ 1,
                is.na(demog_race_42) ~ 0
                                       ))

study1 <- study1 %>%
        mutate(demog_race_89=case_when(
                demog_race_89 == 1 ~ 1,
                is.na(demog_race_89) ~ 0
                                       ))

study1 <- study1 %>%
        mutate(demog_race_99=case_when(
                demog_race_99 == 1 ~ 1,
                is.na(demog_race_99) ~ 0
                                       ))
```


With that task finished, we can work on making the multiracial composite.


```{r creating a multiracial sum}
study1 <- study1 %>%
        rowwise() %>%
        mutate(
                multiracial_sum=sum(c_across(demog_race_41:demog_race_89
        )))

```

```{r Creating multiracial dummy code}
study1 <- study1 %>%
        mutate(race_multiracial=case_when(
                multiracial_sum > 1 ~ 1,
                multiracial_sum == 1 ~ 0,
                multiracial_sum == 0 ~ 0
        ))

```


Now, I can make the racial composites. Due to sample size constraints I am going to have to make composites for several races. All composites will include their respective races and did not answer more than one race.

##### White composite

Composed of individuals who identified as European/European American, Middle Eastern/Middle Eastern American, Other White; or demog_race_51, demog_race_52, and demog_race_59.

```{r White composite dummy code}
study1 <- study1 %>%
        mutate(
        race_white=case_when(
                demog_race_51 | demog_race_52 | demog_race_59 ~ 1,
                race_multiracial == 1 ~ 0
                ))

study1 <- study1 %>%
        mutate(
          race_white=case_when(
          race_white == 1 ~ 1,
          race_white == 0 ~ 0,
          is.na(race_white) ~ 0 
          ))

```

##### Black composite

Composed of individuals who identified as African American/Black, African, Caribbean, Other Black; or demog_race_21, demog_race_22, demog_race_23, and demog_race_29

```{r Black composite dummy code}
study1 <- study1 %>%
        mutate(
        race_black=case_when(
                demog_race_21 | demog_race_22 | demog_race_23 | demog_race_29 ~ 1,
                race_multiracial == 1 ~ 0
                ))

study1 <- study1 %>%
        mutate(
          race_black=case_when(
          race_black == 1 ~ 1,
          race_black == 0 ~ 0,
          is.na(race_black) ~ 0 
          ))

```

##### Hispanic composite

Composed of individuals who identified as Mexican American/Chicano, Puerto Rican, Central American, Other Hispanic or Latino; or demog_race_31, demog_race_32, demog_race_33, and demog_race_39.

```{r Hispanic composite dummy code}
study1 <- study1 %>%
        mutate(
        race_hispanic=case_when(
                demog_race_31 | demog_race_32 | demog_race_33 | demog_race_39 ~ 1,
                race_multiracial == 1 ~ 0
                ))

study1 <- study1 %>%
        mutate(
          race_hispanic=case_when(
          race_hispanic == 1 ~ 1,
          race_hispanic == 0 ~ 0,
          is.na(race_hispanic) ~ 0 
          ))

```

##### Asian composite

Composed of individuals who identified as East Asian (e.g., Chinese, Japanese, Korean, Taiwanese), Southeast Asian (e.g., Filipino, Vietnamese, Indonesian), South Asian (e.g., Pakistani, Indian, Nepalese, Sri Lankan), Other Asian; or demog_race_11, demog_race_12, demog_race_13, and demog_race_19.


```{r Asian composite dummy code}
study1 <- study1 %>%
        mutate(
        race_asian=case_when(
                demog_race_11 | demog_race_12 | demog_race_13 | demog_race_19 ~ 1,
                race_multiracial == 1 ~ 0
                ))

study1 <- study1 %>%
        mutate(
          race_asian=case_when(
          race_asian == 1 ~ 1,
          race_asian == 0 ~ 0,
          is.na(race_asian) ~ 0 
          ))

```

##### Native composite

Composed of individuals who identified as Native Hawaiian or Other Pacific Islander, American Indian or Alaskan Native; or demog_race_41 and demog_race_42.



```{r Native composite dummy code}
study1 <- study1 %>%
        mutate(
        race_native=case_when(
                demog_race_41 | demog_race_42 ~ 1,
                race_multiracial == 1 ~ 0
                ))

study1 <- study1 %>%
        mutate(
          race_native=case_when(
          race_native == 1 ~ 1,
          race_native == 0 ~ 0,
          is.na(race_native) ~ 0 
          ))

```

With these composites in hand, I can look more closely at how many we have in each category

```{r freq race}
table(study1$race_white)
table(study1$race_black)
table(study1$race_asian)
table(study1$race_hispanic)
table(study1$race_native)
table(study1$race_multiracial)
```

We have no native participants, so it is not needed. The majority of our sample is white, unsurprisingly.

#### Quiz recoding

We need to create dummy coded scores for the quiz, so I can get an average more easily.

```{r quiz question dummy codes}
#Question 1
study1 <- study1 %>%
        mutate(
        Quiz_Q1=case_when(
                Question_1 == 4 ~ 1
                ))

study1 <- study1 %>%
        mutate(
          Quiz_Q1=case_when(
          Quiz_Q1 == 1 ~ 1,
          is.na(Quiz_Q1) ~ 0 
          ))

# Question 2
study1 <- study1 %>%
        mutate(
        Quiz_Q2=case_when(
                Question_2 == 2 ~ 1
                ))

study1 <- study1 %>%
        mutate(
          Quiz_Q2=case_when(
          Quiz_Q2 == 1 ~ 1,
          is.na(Quiz_Q2) ~ 0 
          ))

# Question 3
study1 <- study1 %>%
        mutate(
        Quiz_Q3=case_when(
                Question_3 == 3 ~ 1
                ))

study1 <- study1 %>%
        mutate(
          Quiz_Q3=case_when(
          Quiz_Q3 == 1 ~ 1,
          is.na(Quiz_Q3) ~ 0 
          ))

# Question 4
study1 <- study1 %>%
        mutate(
        Quiz_Q4=case_when(
                Question_4 == 3 ~ 1
                ))

study1 <- study1 %>%
        mutate(
          Quiz_Q4=case_when(
          Quiz_Q4 == 1 ~ 1,
          is.na(Quiz_Q4) ~ 0 
          ))

# Question 5
study1 <- study1 %>%
        mutate(
        Quiz_Q5=case_when(
                Question_5 == 2 ~ 1
                ))

study1 <- study1 %>%
        mutate(
          Quiz_Q5=case_when(
          Quiz_Q5 == 1 ~ 1,
          is.na(Quiz_Q5) ~ 0 
          ))

#Question 6
study1 <- study1 %>%
        mutate(
        Quiz_Q6=case_when(
                Question_6 == 3 ~ 4
                ))

study1 <- study1 %>%
        mutate(
          Quiz_Q6=case_when(
          Quiz_Q6 == 1 ~ 1,
          is.na(Quiz_Q6) ~ 0 
          ))

# Question 7
study1 <- study1 %>%
        mutate(
        Quiz_Q7=case_when(
                Question_7 == 1 ~ 1
                ))

study1 <- study1 %>%
        mutate(
          Quiz_Q7=case_when(
          Quiz_Q7 == 1 ~ 1,
          is.na(Quiz_Q7) ~ 0 
          ))
#Question 8
study1 <- study1 %>%
        mutate(
        Quiz_Q8=case_when(
                Question_8 == 3 ~ 1
                ))

study1 <- study1 %>%
        mutate(
          Quiz_Q8=case_when(
          Quiz_Q8 == 1 ~ 1,
          is.na(Quiz_Q8) ~ 0 
          ))

#Question 9
study1 <- study1 %>%
        mutate(
        Quiz_Q9=case_when(
                Question_9 == 4 ~ 1
                ))

study1 <- study1 %>%
        mutate(
          Quiz_Q9=case_when(
          Quiz_Q9 == 1 ~ 1,
          is.na(Quiz_Q9) ~ 0 
          ))

```


Now that I have all the dummy coded versions, I can more easily compute the average score.

```{r quiz sum}
study1 <- study1 %>%
        rowwise() %>%
        mutate(
                quiz_average=mean(c_across(Quiz_Q1:Quiz_Q9
        )))

study1$quiz_average <- round(study1$quiz_average, digits = 2)

```

### Variables of Interest

Next, we need to create the composite variables for the variables of interest.

#### Manipulation check item

manip_interest manip_personal manip_encourage


### Wrapping up
